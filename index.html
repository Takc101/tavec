<!-- ç½‘é¡µå–æºå·¥å…·ä¸»HTMLæ–‡ä»¶ï¼ŒåŒ…å«é¡µé¢ç»“æ„å’Œæ³¨é‡Š -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- é¡µé¢å­—ç¬¦é›†å’Œè§†å£è®¾ç½® -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘é¡µå–æºå·¥å…·</title>
    <!-- å¼•å…¥MDUIæ ·å¼ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/css/mdui.min.css">
    <style>
    /* ======================
   CSS æ ·å¼è¡¨ - ç½‘é¡µå–æºå·¥å…·
   ====================== */

/* --------------------------
   CSS å˜é‡å®šä¹‰ (è‡ªå®šä¹‰å±æ€§)
   ä½¿ç”¨CSSå˜é‡ä¾¿äºä¸»é¢˜é¢œè‰²çš„ç»Ÿä¸€ç®¡ç†å’Œä¿®æ”¹
   -------------------------- */
:root {
    --primary-color: #2196F3;   /* ä¸»é¢˜ä¸»è‰²ï¼ˆè“è‰²ï¼‰ï¼Œç”¨äºä¸»æŒ‰é’®ã€æ ‡é¢˜ç­‰ä¸»è¦å…ƒç´  */
    --accent-color: #00BCD4;    /* å¼ºè°ƒè‰²ï¼ˆé’è‰²ï¼‰ï¼Œç”¨äºæ¬¡è¦é«˜äº®å…ƒç´  */
    --text-color: #333;         /* ä¸»æ–‡æœ¬é¢œè‰²ï¼ˆæ·±ç°è‰²ï¼‰ï¼Œç”¨äºå¤§éƒ¨åˆ†æ–‡æœ¬å†…å®¹ */
    --light-text: #757575;      /* è¾…åŠ©æ–‡æœ¬é¢œè‰²ï¼ˆæµ…ç°è‰²ï¼‰ï¼Œç”¨äºæ¬¡è¦æ–‡æœ¬æˆ–æç¤ºä¿¡æ¯ */
    --border-color: #e0e0e0;    /* è¾¹æ¡†é¢œè‰²ï¼ˆæµ…ç°è‰²ï¼‰ï¼Œç”¨äºå„ç§è¾¹æ¡† */
    --bg-color: #f5f5f5;        /* èƒŒæ™¯è‰²ï¼ˆææµ…ç°è‰²ï¼‰ï¼Œç”¨äºèƒŒæ™¯åŒºåŸŸ */
}

/* --------------------------
   å…¨å±€æ ·å¼
   -------------------------- */
body {
    background-color: #fafafa;  /* é¡µé¢æ•´ä½“èƒŒæ™¯è‰²ï¼ˆæ›´æµ…çš„ç°è‰²ï¼‰ï¼Œæä¾›æŸ”å’Œçš„è§†è§‰æ•ˆæœ */
    color: var(--text-color);   /* ä½¿ç”¨å®šä¹‰çš„ä¸»æ–‡æœ¬é¢œè‰² */
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; /* ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼Œç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§ */
}

/* --------------------------
   ä¸»å®¹å™¨æ ·å¼
   é™åˆ¶æœ€å¤§å®½åº¦ï¼Œå±…ä¸­æ˜¾ç¤ºï¼Œæ·»åŠ å†…è¾¹è·å’Œé˜´å½±ï¼Œå¢åŠ åœ†è§’ä»¥æå‡è§†è§‰æ•ˆæœ
   -------------------------- */
.container {
    max-width: 900px;           /* ä¸»å®¹å™¨çš„æœ€å¤§å®½åº¦ï¼Œç¡®ä¿åœ¨å¤§å±ä¸Šä¸ä¼šè¿‡å®½ */
    margin: 0 auto;             /* æ°´å¹³å±…ä¸­ */
    padding: 20px;              /* å†…è¾¹è·ï¼Œå¢åŠ å†…å®¹ä¸è¾¹æ¡†çš„è·ç¦» */
    background: white;          /* èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰²ï¼Œæä¾›æ¸…æ™°çš„è§†è§‰å¯¹æ¯” */
    box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* æ·»åŠ è½»å¾®çš„é˜´å½±ï¼Œå¢åŠ å±‚æ¬¡æ„Ÿ */
    border-radius: 8px;         /* åœ†è§’è¾¹æ¡†ï¼Œæå‡è§†è§‰æŸ”å’Œåº¦ */
    margin-top: 20px;           /* ä¸Šè¾¹è·ï¼Œé¿å…ä¸é¡µé¢é¡¶éƒ¨è¿‡äºç´§å‡‘ */
    margin-bottom: 20px;        /* ä¸‹è¾¹è·ï¼Œé¿å…ä¸é¡µé¢åº•éƒ¨è¿‡äºç´§å‡‘ */
}

/* --------------------------
   å¤´éƒ¨æ ·å¼
   å±…ä¸­æ˜¾ç¤ºï¼Œæ·»åŠ ä¸‹è¾¹è·å’Œåº•éƒ¨è¾¹æ¡†ï¼Œå¢å¼ºæ ‡é¢˜åŒºåŸŸçš„åˆ†éš”æ„Ÿ
   -------------------------- */
.header {
    text-align: center;         /* æ–‡æœ¬å±…ä¸­å¯¹é½ */
    margin-bottom: 24px;        /* ä¸‹è¾¹è·ï¼Œå¢åŠ ä¸ä¸‹æ–¹å…ƒç´ çš„è·ç¦» */
    padding-bottom: 16px;       /* åº•éƒ¨å†…è¾¹è·ï¼Œå¢åŠ æ ‡é¢˜ä¸è¾¹æ¡†çš„è·ç¦» */
    border-bottom: 1px solid var(--border-color); /* åº•éƒ¨è¾¹æ¡†ï¼Œé¢œè‰²ä½¿ç”¨å®šä¹‰çš„è¾¹æ¡†é¢œè‰² */
}

/* å¤´éƒ¨æ ‡é¢˜æ ·å¼ */
.header h1 {
    font-size: 24px;            /* å­—ä½“å¤§å° */
    font-weight: 500;           /* å­—ä½“ç²—ç»†ï¼Œä¸­ç­‰ç²—ç»† */
    color: var(--primary-color); /* ä½¿ç”¨ä¸»é¢˜ä¸»è‰²ï¼Œå¢å¼ºæ ‡é¢˜çš„è§†è§‰é‡è¦æ€§ */
    margin: 0;                  /* ç§»é™¤é»˜è®¤çš„å¤–è¾¹è· */
}

/* å¤´éƒ¨è¯´æ˜æ–‡å­—æ ·å¼ */
.header p {
    color: var(--light-text);   /* ä½¿ç”¨è¾…åŠ©æ–‡æœ¬é¢œè‰²ï¼Œé™ä½è§†è§‰é‡è¦æ€§ */
    margin-top: 8px;            /* ä¸Šè¾¹è·ï¼Œå¢åŠ ä¸æ ‡é¢˜çš„è·ç¦» */
    font-size: 14px;            /* å­—ä½“å¤§å°ï¼Œè¾ƒå°ä»¥åŒºåˆ†æ ‡é¢˜ */
}

/* --------------------------
   è¾“å…¥åŒºåŸŸæ ·å¼
   å¢åŠ ä¸‹è¾¹è·ï¼Œç¡®ä¿ä¸å¤´éƒ¨å’Œå…¶ä»–å…ƒç´ æœ‰è¶³å¤Ÿçš„é—´éš”
   -------------------------- */
.input-area {
    margin-bottom: 24px;        /* ä¸‹è¾¹è·ï¼Œå¢åŠ ä¸ä¸‹æ–¹å…ƒç´ çš„é—´è· */
}

/* --------------------------
   æŒ‰é’®ç»„æ ·å¼
   ä½¿ç”¨Flexboxå¸ƒå±€ï¼Œå…è®¸æŒ‰é’®åœ¨å°å±å¹•ä¸Šè‡ªåŠ¨æ¢è¡Œï¼Œå¢åŠ æŒ‰é’®ä¹‹é—´çš„é—´éš™
   -------------------------- */
.button-group {
    display: flex;              /* ä½¿ç”¨Flexboxå¸ƒå±€ */
    flex-wrap: wrap;            /* å…è®¸æŒ‰é’®åœ¨ç©ºé—´ä¸è¶³æ—¶è‡ªåŠ¨æ¢è¡Œ */
    gap: 12px;                  /* æŒ‰é’®ä¹‹é—´çš„é—´éš™ */
    margin-bottom: 24px;        /* ä¸‹è¾¹è·ï¼Œå¢åŠ ä¸ä¸‹æ–¹å…ƒç´ çš„é—´è· */
}

/* æŒ‰é’®ç»„ä¸­çš„æŒ‰é’®æ ·å¼ */
.button-group .mdui-btn {
    flex: 1;                    /* æŒ‰é’®åœ¨å®¹å™¨ä¸­å‡åŒ€åˆ†é…ç©ºé—´ */
    min-width: 140px;           /* æŒ‰é’®çš„æœ€å°å®½åº¦ï¼Œç¡®ä¿æŒ‰é’®ä¸ä¼šè¿‡çª„ */
    height: 44px;               /* æŒ‰é’®é«˜åº¦ï¼Œæä¾›åˆé€‚çš„ç‚¹å‡»åŒºåŸŸ */
    font-size: 15px;            /* å­—ä½“å¤§å° */
    border-radius: 4px;         /* åœ†è§’è¾¹æ¡†ï¼Œæå‡è§†è§‰æŸ”å’Œåº¦ */
    text-transform: none;       /* ä¸è½¬æ¢æ–‡æœ¬ä¸ºå¤§å†™ï¼Œä¿æŒåŸæ · */
}

/* --------------------------
   é€‰é¡¹å¡å®¹å™¨æ ·å¼
   å¢åŠ ä¸Šè¾¹è·ï¼Œæ·»åŠ åœ†è§’å’Œé˜´å½±ï¼Œå¢å¼ºè§†è§‰å±‚æ¬¡æ„Ÿ
   -------------------------- */
.tab-container {
    margin-top: 16px;           /* ä¸Šè¾¹è·ï¼Œå¢åŠ ä¸ä¸Šæ–¹å…ƒç´ çš„é—´è· */
    border-radius: 8px;         /* åœ†è§’è¾¹æ¡† */
    overflow: hidden;           /* éšè—æº¢å‡ºå†…å®¹ï¼Œç¡®ä¿åœ†è§’æ•ˆæœ */
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* æ·»åŠ è½»å¾®çš„é˜´å½±ï¼Œå¢åŠ å±‚æ¬¡æ„Ÿ */
}

/* é€‰é¡¹å¡æ•´ä½“æ ·å¼ */
.mdui-tab {
    background-color: white;    /* èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰² */
    padding: 0 16px;            /* å·¦å³å†…è¾¹è· */
    font-size: 15px;            /* å­—ä½“å¤§å° */
    font-weight: 500;           /* å­—ä½“ç²—ç»†ï¼Œä¸­ç­‰ç²—ç»† */
}

/* é€‰é¡¹å¡é“¾æ¥æ ·å¼ */
.mdui-tab a {
    padding: 16px 20px;         /* ä¸Šä¸‹å’Œå·¦å³å†…è¾¹è· */
    color: var(--light-text);   /* ä½¿ç”¨è¾…åŠ©æ–‡æœ¬é¢œè‰²ï¼Œé™ä½æœªæ¿€æ´»é€‰é¡¹å¡çš„è§†è§‰é‡è¦æ€§ */
}

/* æ¿€æ´»çŠ¶æ€çš„é€‰é¡¹å¡é“¾æ¥æ ·å¼ */
.mdui-tab a.mdui-tab-active {
    color: var(--primary-color); /* ä½¿ç”¨ä¸»é¢˜ä¸»è‰²ï¼Œçªå‡ºæ˜¾ç¤ºå½“å‰æ¿€æ´»çš„é€‰é¡¹å¡ */
}

/* --------------------------
   ç»“æœå®¹å™¨æ ·å¼
   è®¾ç½®å›ºå®šé«˜åº¦ï¼ŒèƒŒæ™¯é¢œè‰²ï¼Œè¾¹æ¡†å’Œåœ†è§’ï¼Œä½¿ç”¨Flexboxå¸ƒå±€ä»¥åˆ†å‰²æ–‡ä»¶æ ‘å’Œä»£ç è§†å›¾
   -------------------------- */
.result-container {
    height: 550px;              /* å›ºå®šé«˜åº¦ï¼Œç¡®ä¿ç»“æœåŒºåŸŸçš„ä¸€è‡´æ€§ */
    background-color: white;    /* èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰² */
    border: 1px solid var(--border-color); /* è¾¹æ¡†é¢œè‰²ä½¿ç”¨å®šä¹‰çš„è¾¹æ¡†é¢œè‰² */
    border-top: none;           /* ç§»é™¤ä¸Šè¾¹æ¡†ï¼Œä¸ä¸Šæ–¹å…ƒç´ æ— ç¼è¿æ¥ */
    border-radius: 0 0 8px 8px; /* åº•éƒ¨åœ†è§’ï¼Œä¸ä¸Šæ–¹å…ƒç´ å½¢æˆè§†è§‰è¡”æ¥ */
    position: relative;         /* ç›¸å¯¹å®šä½ï¼Œä¸ºåŠ è½½åŠ¨ç”»ç­‰ç»å¯¹å®šä½å…ƒç´ æä¾›å‚è€ƒ */
    display: flex;              /* ä½¿ç”¨Flexboxå¸ƒå±€ï¼Œå°†å®¹å™¨åˆ†ä¸ºæ–‡ä»¶æ ‘å’Œä»£ç è§†å›¾ä¸¤éƒ¨åˆ† */
}

/* --------------------------
   æ–‡ä»¶æ ‘å®¹å™¨æ ·å¼
   å›ºå®šå®½åº¦ï¼Œæ·»åŠ å³è¾¹æ¡†å’Œå†…è¾¹è·ï¼ŒèƒŒæ™¯é¢œè‰²ç¨æµ…ï¼Œæä¾›ä¸ä»£ç è§†å›¾çš„è§†è§‰åŒºåˆ†
   -------------------------- */
.file-tree-container {
    width: 270px;               /* å›ºå®šå®½åº¦ */
    border-right: 1px solid var(--border-color); /* å³ä¾§è¾¹æ¡†ï¼Œé¢œè‰²ä½¿ç”¨å®šä¹‰çš„è¾¹æ¡†é¢œè‰² */
    background: #f8f9fa;        /* èƒŒæ™¯é¢œè‰²ç¨æµ…ï¼Œæä¾›è§†è§‰åŒºåˆ† */
    overflow-y: auto;           /* å…è®¸å‚ç›´æ»šåŠ¨ï¼Œç¡®ä¿å†…å®¹è¿‡å¤šæ—¶å¯æ»šåŠ¨æŸ¥çœ‹ */
    padding: 12px 4px 12px 12px; /* å†…è¾¹è·ï¼Œå¢åŠ å†…å®¹ä¸è¾¹æ¡†çš„è·ç¦» */
}

/* --------------------------
   æ–‡ä»¶æ ‘æ ·å¼
   ç§»é™¤é»˜è®¤åˆ—è¡¨æ ·å¼ï¼Œè®¾ç½®å­—ä½“å¤§å°
   -------------------------- */
.file-tree {
    list-style: none;           /* ç§»é™¤é»˜è®¤çš„åˆ—è¡¨é¡¹ç›®ç¬¦å· */
    padding-left: 0;            /* ç§»é™¤é»˜è®¤çš„å·¦ä¾§å†…è¾¹è· */
    margin: 0;                  /* ç§»é™¤é»˜è®¤çš„å¤–è¾¹è· */
    font-size: 13px;            /* å­—ä½“å¤§å°ï¼Œç¨å°ä»¥åŒºåˆ†å…¶ä»–æ–‡æœ¬ */
}

/* æ–‡ä»¶æ ‘ä¸­çš„æ¯ä¸ªé¡¹ç›®æ ·å¼ */
.file-tree li {
    margin-bottom: 7px;         /* é¡¹ç›®ä¹‹é—´çš„ä¸‹è¾¹è·ï¼Œå¢åŠ é—´éš” */
    cursor: pointer;            /* é¼ æ ‡æŒ‡é’ˆå˜ä¸ºæ‰‹å‹ï¼Œæç¤ºå¯ç‚¹å‡» */
    padding: 2px 7px;           /* ä¸Šä¸‹å’Œå·¦å³å†…è¾¹è·ï¼Œå¢åŠ ç‚¹å‡»åŒºåŸŸ */
    border-radius: 4px;         /* åœ†è§’è¾¹æ¡†ï¼Œæå‡è§†è§‰æŸ”å’Œåº¦ */
    transition: background .15s; /* èƒŒæ™¯é¢œè‰²è¿‡æ¸¡æ•ˆæœï¼Œæå‡äº¤äº’ä½“éªŒ */
    word-break: break-all;      /* å…è®¸é•¿å•è¯æˆ–URLåœ¨ä»»æ„å­—ç¬¦å¤„æ¢è¡Œï¼Œé˜²æ­¢æº¢å‡º */
}

/* æ¿€æ´»çŠ¶æ€æˆ–é¼ æ ‡æ‚¬åœæ—¶çš„æ–‡ä»¶æ ‘é¡¹ç›®æ ·å¼ */
.file-tree li.active, .file-tree li:hover {
    background: #e3f2fd;        /* èƒŒæ™¯é¢œè‰²å˜ä¸ºä¸»é¢˜è‰²çš„æµ…è‰²ï¼Œçªå‡ºæ˜¾ç¤ºå½“å‰é€‰ä¸­æˆ–æ‚¬åœçš„é¡¹ç›® */
}

/* æ–‡ä»¶URLæ ·å¼ */
.file-url {
    display: block;             /* å—çº§å…ƒç´ ï¼Œå æ®æ•´è¡Œ */
    font-size: 12px;            /* å­—ä½“å¤§å°ï¼Œè¾ƒå°ä»¥åŒºåˆ†é¡¹ç›®åç§° */
    color: #888;                /* æ–‡æœ¬é¢œè‰²ï¼Œè¾ƒæµ…ï¼Œè¡¨ç¤ºè¾…åŠ©ä¿¡æ¯ */
    margin-top: 2px;            /* ä¸Šè¾¹è·ï¼Œå¢åŠ ä¸é¡¹ç›®åç§°çš„è·ç¦» */
    word-break: break-all;      /* å…è®¸é•¿URLåœ¨ä»»æ„å­—ç¬¦å¤„æ¢è¡Œï¼Œé˜²æ­¢æº¢å‡º */
}

/* --------------------------
   ä»£ç è§†å›¾å®¹å™¨æ ·å¼
   ä½¿ç”¨Flexboxå æ®å‰©ä½™ç©ºé—´ï¼Œå…è®¸å†…å®¹æº¢å‡ºæ—¶æ»šåŠ¨ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²
   -------------------------- */
.code-view-container {
    flex: 1;                    /* ä½¿ç”¨Flexboxå æ®å‰©ä½™ç©ºé—´ */
    overflow: auto;             /* å…è®¸å†…å®¹æº¢å‡ºæ—¶æ»šåŠ¨ */
    position: relative;         /* ç›¸å¯¹å®šä½ï¼Œä¸ºåŠ è½½åŠ¨ç”»ç­‰ç»å¯¹å®šä½å…ƒç´ æä¾›å‚è€ƒ */
    background-color: #f8f9fa;  /* èƒŒæ™¯é¢œè‰²ç¨æµ…ï¼Œæä¾›è§†è§‰åŒºåˆ† */
}

/* ä»£ç é¢„è§ˆåŒºåŸŸæ ·å¼ */
pre {
    margin: 0;                  /* ç§»é™¤é»˜è®¤çš„å¤–è¾¹è· */
    white-space: pre-wrap;      /* ä¿ç•™ç©ºç™½ç¬¦ï¼Œä½†å…è®¸è‡ªåŠ¨æ¢è¡Œ */
    word-wrap: break-word;      /* å…è®¸é•¿å•è¯æˆ–URLåœ¨ä»»æ„å­—ç¬¦å¤„æ¢è¡Œï¼Œé˜²æ­¢æº¢å‡º */
    font-size: 14px;            /* å­—ä½“å¤§å° */
    font-family: 'Roboto Mono', monospace; /* ä½¿ç”¨ç­‰å®½å­—ä½“ï¼Œç¡®ä¿ä»£ç å¯¹é½ */
    padding: 16px;              /* å†…è¾¹è·ï¼Œå¢åŠ å†…å®¹ä¸è¾¹æ¡†çš„è·ç¦» */
    min-height: 100%;           /* æœ€å°é«˜åº¦ï¼Œç¡®ä¿ä»£ç è§†å›¾å¡«å……å®¹å™¨ */
    color: #333;                /* æ–‡æœ¬é¢œè‰²ï¼Œä½¿ç”¨ä¸»æ–‡æœ¬é¢œè‰² */
}

/* --------------------------
   é¢„è§ˆæ¡†æ¶æ ·å¼
   è®¾ç½®å®½åº¦ä¸é«˜åº¦ä¸º100%ï¼Œç§»é™¤è¾¹æ¡†ï¼ŒèƒŒæ™¯é¢œè‰²ä¸ºç™½è‰²
   -------------------------- */
#preview-frame {
    width: 100%;                /* å®½åº¦å æ®çˆ¶å®¹å™¨çš„100% */
    height: 100%;               /* é«˜åº¦å æ®çˆ¶å®¹å™¨çš„100% */
    border: none;               /* ç§»é™¤è¾¹æ¡†ï¼Œä¸å®¹å™¨æ— ç¼è¿æ¥ */
    background: white;          /* èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰² */
}

/* --------------------------
   åŠ è½½åŠ¨ç”»æ ·å¼
   ç»å¯¹å®šä½ï¼Œè¦†ç›–æ•´ä¸ªç»“æœå®¹å™¨ï¼Œå±…ä¸­æ˜¾ç¤ºåŠ è½½åŠ¨ç”»å’Œæç¤ºä¿¡æ¯
   -------------------------- */
.loading {
    position: absolute;         /* ç»å¯¹å®šä½ï¼Œç›¸å¯¹äº.result-container */
    top: 0;                     /* ä¸Šè¾¹ç¼˜å¯¹é½ */
    left: 0;                    /* å·¦è¾¹ç¼˜å¯¹é½ */
    right: 0;                   /* å³è¾¹ç¼˜å¯¹é½ */
    bottom: 0;                  /* ä¸‹è¾¹ç¼˜å¯¹é½ */
    display: flex;              /* ä½¿ç”¨Flexboxå¸ƒå±€ï¼Œå±…ä¸­å­å…ƒç´  */
    justify-content: center;    /* æ°´å¹³å±…ä¸­ */
    align-items: center;        /* å‚ç›´å±…ä¸­ */
    background-color: rgba(255,255,255,0.8); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ï¼Œç¡®ä¿åŠ è½½åŠ¨ç”»å¯è§ä½†ä¸å®Œå…¨é®æŒ¡å†…å®¹ */
    z-index: 100;               /* é«˜z-indexï¼Œç¡®ä¿åŠ è½½åŠ¨ç”»ä½äºé¡¶å±‚ */
}

/* --------------------------
   çŠ¶æ€æ æ ·å¼
   ä½¿ç”¨Flexboxå¸ƒå±€ï¼Œå·¦å³å¯¹é½ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²ã€è¾¹æ¡†å’Œå­—ä½“é¢œè‰²
   -------------------------- */
.status-bar {
    display: flex;              /* ä½¿ç”¨Flexboxå¸ƒå±€ */
    justify-content: space-between; /* å·¦å³ä¸¤ç«¯å¯¹é½å­å…ƒç´  */
    align-items: center;        /* å‚ç›´å±…ä¸­å­å…ƒç´  */
    padding: 8px 16px;          /* ä¸Šä¸‹å’Œå·¦å³å†…è¾¹è· */
    background-color: var(--bg-color); /* èƒŒæ™¯é¢œè‰²ä½¿ç”¨å®šä¹‰çš„èƒŒæ™¯è‰² */
    border-top: 1px solid var(--border-color); /* ä¸Šè¾¹æ¡†ï¼Œé¢œè‰²ä½¿ç”¨å®šä¹‰çš„è¾¹æ¡†é¢œè‰² */
    font-size: 13px;            /* å­—ä½“å¤§å°ï¼Œè¾ƒå°ä»¥åŒºåˆ†ä¸»è¦å†…å®¹ */
    color: var(--light-text);   /* æ–‡æœ¬é¢œè‰²ä½¿ç”¨è¾…åŠ©æ–‡æœ¬é¢œè‰²ï¼Œé™ä½è§†è§‰é‡è¦æ€§ */
}

/* --------------------------
   å“åº”å¼å¸ƒå±€ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰
   å½“å±å¹•å®½åº¦å°äºç­‰äº768pxæ—¶ï¼Œè°ƒæ•´å„å…ƒç´ çš„æ ·å¼ä»¥é€‚åº”å°å±å¹•
   -------------------------- */
@media (max-width: 768px) {
    .container { 
        margin: 10px;           /* å‡å°‘å®¹å™¨çš„å¤–è¾¹è·ï¼Œé€‚åº”å°å±å¹• */
        padding: 16px;          /* å‡å°‘å†…è¾¹è·ï¼Œå¢åŠ å†…å®¹åŒºåŸŸ */
    }
    .button-group .mdui-btn { 
        flex: 100%;             /* æŒ‰é’®åœ¨å°å±å¹•ä¸Šå æ®æ•´è¡Œï¼Œé¿å…æ¢è¡Œå¯¼è‡´çš„å¸ƒå±€æ··ä¹± */
    }
    .result-container { 
        height: 400px;          /* å‡å°‘ç»“æœå®¹å™¨çš„é«˜åº¦ï¼Œé€‚åº”å°å±å¹• */
    }
    .mdui-tab a { 
        padding: 12px 16px;     /* å‡å°‘é€‰é¡¹å¡é“¾æ¥çš„å†…è¾¹è·ï¼Œé€‚åº”å°å±å¹• */
        font-size: 14px;        /* å‡å°å­—ä½“å¤§å°ï¼Œå¢åŠ ç©ºé—´åˆ©ç”¨ç‡ */
    }
    .file-tree-container { 
        width: 120px;           /* å‡å°‘æ–‡ä»¶æ ‘å®¹å™¨çš„å®½åº¦ï¼Œé€‚åº”å°å±å¹• */
    }
}

/* --------------------------
   å¤´éƒ¨å›¾ç‰‡æ ·å¼
   è®¾ç½®æœ€å¤§å®½åº¦ï¼Œä¿æŒå›¾ç‰‡æ¯”ä¾‹ï¼Œæ·»åŠ ä¸Šè¾¹è·ã€åœ†è§’å’Œé˜´å½±ï¼Œåˆ›å»ºæ¼‚æµ®åŠ¨ç”»æ•ˆæœ
   -------------------------- */
.header img {
    max-width: 100px;           /* å›¾ç‰‡æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢è¿‡å¤§ */
    height: auto;               /* é«˜åº¦è‡ªåŠ¨è°ƒæ•´ï¼Œä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
    margin-top: 15px;           /* ä¸Šè¾¹è·ï¼Œå¢åŠ ä¸æ ‡é¢˜çš„è·ç¦» */
    border-radius: 4px;         /* åœ†è§’è¾¹æ¡†ï¼Œæå‡è§†è§‰æŸ”å’Œåº¦ */
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* æ·»åŠ è½»å¾®çš„é˜´å½±ï¼Œå¢åŠ å±‚æ¬¡æ„Ÿ */
    position: relative;         /* ç›¸å¯¹å®šä½ï¼Œä¸ºåŠ¨ç”»æä¾›å‚è€ƒ */
    animation: float 3s ease-in-out infinite; /* åº”ç”¨æ¼‚æµ®åŠ¨ç”»ï¼Œæ— é™å¾ªç¯ */
}

/* --------------------------
   æ¼‚æµ®åŠ¨ç”»å®šä¹‰
   ä½¿ç”¨@keyframeså®šä¹‰ä¸€ä¸ªä¸Šä¸‹æµ®åŠ¨çš„åŠ¨ç”»æ•ˆæœï¼Œåº”ç”¨äºå¤´éƒ¨å›¾ç‰‡
   -------------------------- */
@keyframes float {
    0% { transform: translateY(0px); }          /* åŠ¨ç”»èµ·å§‹ç‚¹ï¼Œæ— ä½ç§» */
    50% { transform: translateY(-10px); }       /* åŠ¨ç”»ä¸­é—´ç‚¹ï¼Œå‘ä¸Šæµ®åŠ¨10px */
    100% { transform: translateY(0px); }        /* åŠ¨ç”»ç»“æŸç‚¹ï¼Œå›åˆ°èµ·å§‹ä½ç½® */
}

/* åœ¨å°å±å¹•ä¸Šè°ƒæ•´å¤´éƒ¨å›¾ç‰‡çš„æ¼‚æµ®åŠ¨ç”» */
@media (max-width: 768px) {
    .header img {
        max-width: 80px;        /* å‡å°‘å›¾ç‰‡æœ€å¤§å®½åº¦ï¼Œé€‚åº”å°å±å¹• */
        margin-top: 10px;       /* å‡å°‘ä¸Šè¾¹è·ï¼Œé€‚åº”å°å±å¹• */
        animation: float 2.5s ease-in-out infinite; /* è°ƒæ•´åŠ¨ç”»æ—¶é•¿ï¼Œä½¿å…¶æ›´ç´§å‡‘ */
    }
}

/* --------------------------
   æŒ‰é’®ä¸»é¢˜è‰²æ‰©å±•
   ä¸ºä¸åŒåŠŸèƒ½çš„æŒ‰é’®å®šä¹‰ç‰¹å®šçš„èƒŒæ™¯é¢œè‰²ï¼Œä¾¿äºç”¨æˆ·å¿«é€Ÿè¯†åˆ«æŒ‰é’®åŠŸèƒ½
   -------------------------- */
/* è·å–æºä»£ç æŒ‰é’® */
.btn-fetch { 
    background-color: var(--primary-color) !important;         /* ä½¿ç”¨ä¸»é¢˜ä¸»è‰²ä½œä¸ºèƒŒæ™¯è‰² */
}
.btn-fetch:hover { 
    background-color: #D7FFF1 !important;                      /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²å˜ä¸º...ï¼Œæä¾›è§†è§‰åé¦ˆ */
}

/* å¤åˆ¶æŒ‰é’® */
.btn-copy { 
    background-color: #f199bc !important;                      /* ä½¿ç”¨ç²‰è‰²ä½œä¸ºèƒŒæ™¯è‰² */
}
.btn-copy:hover { 
    background-color: #00dffc !important;                      /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²å˜ä¸ºè“è‰²ï¼Œæä¾›è§†è§‰åé¦ˆ */
}

/* æ¸…ç©ºæŒ‰é’® */
.btn-clear { 
    background-color: #ede574 !important;                      /* ä½¿ç”¨é»„è‰²èƒŒæ™¯è‰² */
}
.btn-clear:hover { 
    background-color: #E71D36 !important;                      /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²ï¼Œæä¾›è§†è§‰åé¦ˆ */
}

/* ä¸€é”®å¡«å……httpæŒ‰é’® */
.btn-httpfill { 
    background-color: #75D701 !important;                      /* ä½¿ç”¨ç»¿è‰²èƒŒæ™¯è‰² */
}
.btn-httpfill:hover { 
    background-color: #A593E0 !important;                      /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²ï¼Œæä¾›è§†è§‰åé¦ˆ */
}

/* å†å²è®°å½•æŒ‰é’®æ ·å¼ */
.btn-history { 
    background-color: var(--accent-color) !important;          /* ä½¿ç”¨å¼ºè°ƒè‰² ä½œä¸ºèƒŒæ™¯è‰²ï¼Œä¸ä¸»é¢˜åè°ƒ */
}
.btn-history:hover { 
    background-color: #eb9f9f !important;                      /* é¼ æ ‡æ‚¬åœæ—¶èƒŒæ™¯è‰²ï¼Œæä¾›è§†è§‰åé¦ˆ */
}

    </style>
</head>
<body class="mdui-theme-primary-blue mdui-theme-accent-cyan">
    <!-- ä¸»å†…å®¹å®¹å™¨ -->
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜å’Œè¯´æ˜ -->
        <div class="header">
            <h1>ç½‘é¡µå–æºå·¥å…·</h1>
            <p>è·å–ä»»æ„ç½‘é¡µçš„æºä»£ç ã€å“åº”å¤´å’Œå…ƒæ•°æ®</p>
            <img src="appicon.png">
        </div>
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-area">
            <div class="mdui-textfield mdui-textfield-floating-label">
                <i class="mdui-icon material-icons">link</i>
                <label class="mdui-textfield-label">è¾“å…¥ç½‘å€</label>
                <input class="mdui-textfield-input" type="url" id="url" placeholder="è¾“å…¥ç½‘å€ | https://example.com" required/> <!-- åŸæœ¬https://example.comä¸â€œè¾“å…¥ç½‘å€â€é‡å äº† ç›´æ¥é‡‡å–æœ€ç®€å•çš„æªæ–½ è¾“å…¥ç½‘å€ | https://example.comğŸ¤“ğŸ¤“ğŸ¤“ -->
                <div class="mdui-textfield-helper">è¯·è¾“å…¥å®Œæ•´çš„URLåœ°å€ï¼ŒåŒ…å«http://æˆ–https://</div>
            </div>
        </div>
        <!-- æŒ‰é’®ç»„ï¼Œå¸ƒå±€ç»Ÿä¸€ -->
<div class="button-group">
    <button class="mdui-btn mdui-btn-raised mdui-ripple btn-fetch" onclick="fetchAllFiles()">
        <i class="mdui-icon material-icons">code</i> è·å–æ‰€æœ‰æ–‡ä»¶
    </button>
    <button class="mdui-btn mdui-btn-raised mdui-ripple btn-copy" onclick="copyToClipboard()">
        <i class="mdui-icon material-icons">content_copy</i> å¤åˆ¶ä»£ç 
    </button>
    <button class="mdui-btn mdui-btn-raised mdui-ripple btn-httpfill" onclick="fillHttp()">
        <i class="mdui-icon material-icons">flash_on</i> ä¸€é”®å¡«å……http
    </button>
    <button class="mdui-btn mdui-btn-raised mdui-ripple btn-clear" onclick="clearAll()">
        <i class="mdui-icon material-icons">clear</i> æ¸…ç©º
    </button>
    <button class="mdui-btn mdui-btn-raised mdui-ripple btn-history" onclick="showHistory()">
        <i class="mdui-icon material-icons">history</i> å†å²è®°å½•
    </button>
</div>

<!-- åœ¨çŠ¶æ€æ ä¸‹æ–¹æ·»åŠ å†å²è®°å½•å¼¹å‡ºå±‚ -->
<div class="mdui-dialog" id="history-dialog">
    <div class="mdui-dialog-title">æµè§ˆå†å²</div>
    <div class="mdui-dialog-content">
        <div id="history-list" class="mdui-list">
            <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            <div class="mdui-list-item mdui-ripple" style="text-align: center; color: #999;">
                æš‚æ— å†å²è®°å½•
            </div>
        </div>
    </div>
    <div class="mdui-dialog-actions">
        <button class="mdui-btn mdui-ripple" mdui-dialog-close>å…³é—­</button>
        <button class="mdui-btn mdui-ripple" onclick="clearHistory()">
            <i class="mdui-icon material-icons">delete</i> æ¸…ç©ºå†å²
        </button>
    </div>
</div>
<!-- ä»£ç é¢„è§ˆå¼¹çª— åŒå‡»æ‰“å¼€ -->
<div class="mdui-dialog" id="code-preview-dialog" style="width: 95%; max-width: 1200px; max-height: 85vh;">
    <div class="mdui-dialog-title">
        <span id="code-preview-title">æºä»£ç é¢„è§ˆ</span>
        <button class="mdui-btn mdui-btn-icon mdui-btn-dense mdui-dialog-close" style="float: right;">
            <i class="mdui-icon material-icons">close</i>
        </button>
    </div>
    <div class="mdui-dialog-content" style="max-height: calc(85vh - 120px); overflow-y: auto; padding: 16px; background-color: #f8f9fa; margin: 0; border-radius: 4px;">
        <pre id="code-preview-content" style="margin: 0; padding: 0; font-size: 14px; font-family: 'Roboto Mono', monospace; color: #333;"></pre>
    </div>
    <div class="mdui-dialog-actions">
        <button class="mdui-btn mdui-btn-raised mdui-ripple" id="copy-preview-code-btn">
            <i class="mdui-icon material-icons">content_copy</i> å¤åˆ¶ä»£ç 
        </button>
        <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-dialog-close">
            å…³é—­
        </button>
    </div>
</div>

        <!-- é€‰é¡¹å¡å®¹å™¨ -->
        <div class="tab-container">
            <div class="mdui-tab mdui-tab-scrollable" id="tab">
                <a href="#source-tab" class="mdui-ripple mdui-tab-active">
                    <i class="mdui-icon material-icons mdui-icon-left">code</i>æºä»£ç 
                </a>
                <a href="#headers-tab" class="mdui-ripple">
                    <i class="mdui-icon material-icons mdui-icon-left">list</i>å“åº”å¤´
                </a>
                <a href="#preview-tab" class="mdui-ripple">
                    <i class="mdui-icon material-icons mdui-icon-left">visibility</i>é¢„è§ˆ
                </a>
                <a href="#metadata-tab" class="mdui-ripple">
                    <i class="mdui-icon material-icons mdui-icon-left">info</i>å…ƒæ•°æ®
                </a>
            </div>
            <!-- æºä»£ç ç»“æœé¢æ¿ï¼ˆåŠ å…¥æ–‡ä»¶æ ‘ï¼‰ -->
            <div id="source-tab" class="result-container">
                <!-- æ–‡ä»¶æ ‘ -->
                <div class="file-tree-container">
                    <ul class="file-tree" id="file-tree">æš‚æ— æ–‡ä»¶</ul>
                </div>
                <!-- ä»£ç é¢„è§ˆåŒº -->
                <div class="code-view-container">
                    <pre id="source-result">è¯·è¾“å…¥URLå¹¶ç‚¹å‡»"è·å–æ‰€æœ‰æ–‡ä»¶"æŒ‰é’®<br><br><br><br>åŒå‡»å¯é¢„è§ˆä»£ç </pre>
                </div>
            </div>
            <!-- å“åº”å¤´Tab -->
            <div id="headers-tab" class="result-container" style="display:none">
                <pre id="headers-result">å“åº”å¤´ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</pre>
            </div>
            <!-- é¢„è§ˆTab -->
            <div id="preview-tab" class="result-container" style="display:none">
                <iframe id="preview-frame"></iframe>
            </div>
            <!-- å…ƒæ•°æ®Tab -->
            <div id="metadata-tab" class="result-container" style="display:none">
                <pre id="metadata-result">é¡µé¢å…ƒæ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</pre>
            </div>
            <!-- çŠ¶æ€æ  -->
            <div class="status-bar">
                <span id="status-message">å°±ç»ª</span>
                <span id="response-time"></span>
            </div>
        </div>
    </div>
    <!-- ä»£ç é«˜äº® -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- å¼•å…¥MDUI JSåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/js/mdui.min.js"></script>
    <script src="baohu.js"></script>
    <!-- ä¸»é€»è¾‘JSï¼ŒåŒ…å«ä¿æŠ¤åå•åŠŸèƒ½å’Œæ³¨é‡Š -->
    <script>
// ======================
// ç½‘é¡µå–æºå·¥å…· - 6.0
// 2025-8-30
// ======================

// ==== ä¿æŠ¤åå•è®¾ç½®ï¼Œç¦æ­¢çˆ¬å–åå•å†…ä¸»åŸŸå ====
const PROTECTED_LIST = [
    'baidu.com',
    'qq.com',
    'example.com',
    'è”¡å¾å¤.com',
    // å¯ç»§ç»­æ·»åŠ 
];

// ==== ä¿æŠ¤åå•æ£€æµ‹å‡½æ•° ====
function isProtected(url) {
    try {
        const u = new URL(url);
        let hostname = u.hostname.toLowerCase();
        if (hostname.startsWith('www.')) hostname = hostname.slice(4);
        return PROTECTED_LIST.some(domain => hostname === domain || hostname.endsWith('.' + domain));
    } catch {
        return false;
    }
}

// ==== èµ„æºç±»å‹æ‰©å±•è¡¨ ====
const EXTENSION_TYPE_MAP = {
    // æ–‡æ¡£
    'html': 'html', 'htm': 'html', 'xhtml': 'html',
    // æ ·å¼
    'css': 'css',
    // è„šæœ¬
    'js': 'js', 'mjs': 'js', 'cjs': 'js',
    // å›¾ç‰‡
    'png': 'img', 'jpg': 'img', 'jpeg': 'img', 'gif': 'img', 'svg': 'img', 'ico': 'img',
    'bmp': 'img', 'webp': 'img', 'apng': 'img', 'tiff': 'img', 'jfif': 'img', 'pjpeg': 'img', 'pjp': 'img',
    // éŸ³é¢‘
    'mp3': 'media', 'wav': 'media', 'ogg': 'media', 'aac': 'media', 'flac': 'media', 'm4a': 'media', 'mp2': 'media', 'opus': 'media',
    // è§†é¢‘
    'mp4': 'media', 'webm': 'media', 'mov': 'media', 'avi': 'media', 'mkv': 'media', 'flv': 'media', '3gp': 'media', 'mpeg': 'media',
    // å­—ä½“
    'woff': 'font', 'woff2': 'font', 'ttf': 'font', 'otf': 'font', 'eot': 'font',
    // å…¶å®ƒ
    'json': 'other', 'xml': 'other', 'pdf': 'other', 'zip': 'other', 'rar': 'other', '7z': 'other', 'tar': 'other', 'gz': 'other',
};

// ==== çŠ¶æ€ç®¡ç† ====
const state = {
    isFetching: false,
    lastFetchTime: 0,
    MIN_FETCH_INTERVAL: 3000, // æœ€å°è·å–é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    files: [], // å½“å‰é¡µé¢çš„èµ„æºæ–‡ä»¶åˆ—è¡¨
    fileContent: {}, // ç¼“å­˜çš„æ–‡ä»¶å†…å®¹
    selectedFile: '', // å½“å‰é€‰ä¸­çš„æ–‡ä»¶
    baseUrl: '', // å½“å‰é¡µé¢çš„åŸºç¡€URL
    history: [] // å†å²è®°å½•æ•°ç»„ï¼Œå­˜å‚¨å·²çˆ¬å–çš„URL
};

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    new mdui.Tab('#tab'); // åˆå§‹åŒ–MDUIé€‰é¡¹å¡

    // ç›‘å¬URLè¾“å…¥æ¡†çš„å›è½¦äº‹ä»¶ï¼ŒæŒ‰å›è½¦é”®æ—¶è§¦å‘è·å–æ‰€æœ‰æ–‡ä»¶
    document.getElementById('url').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') fetchAllFiles();
    });
});

// ==== çŠ¶æ€æ ä¿¡æ¯æ›´æ–°å‡½æ•° ====
function updateStatus(message, time = null) {
    const statusEl = document.getElementById('status-message');
    const timeEl = document.getElementById('response-time');
    if (statusEl) statusEl.textContent = message;
    if (time !== null && timeEl) timeEl.textContent = `å“åº”æ—¶é—´: ${time}ms`;
}

// ==== æ˜¾ç¤ºåŠ è½½åŠ¨ç”»å‡½æ•° ====
function showLoading(msg = "æ­£åœ¨åŠ è½½...") {
    document.getElementById('source-result').innerHTML = `
        <div class="loading">
            <div class="mdui-spinner mdui-spinner-colorful"></div>
            <span>${msg}</span>
        </div>`;
}

// ==== MDUIæç¤ºæ¡å‡½æ•° ====
function showSnackbar(message, type = 'info') {
    mdui.snackbar({
        message,
        position: 'right-bottom',
        buttonText: 'å…³é—­',
        timeout: 2000,
        closeOnOutsideClick: true
    });
}

// ==== æ¸…ç©ºæ‰€æœ‰è¾“å…¥åŠç»“æœå‡½æ•° ====
function clearAll() {
    ['url', 'source-result', 'headers-result', 'metadata-result'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = el.textContent = '';
    });
    const preview = document.getElementById('preview-frame');
    if (preview) preview.src = '';
    document.getElementById('file-tree').innerHTML = 'æš‚æ— æ–‡ä»¶';
    updateStatus('å·²æ¸…ç©º');
    state.files = [];
    state.fileContent = {};
    state.selectedFile = '';
    state.baseUrl = '';
}

// ==== å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿å‡½æ•°ï¼Œæ·»åŠ ä½œè€…ä¿¡æ¯ ====
function copyToClipboard() {
    const sourceResult = document.getElementById('source-result');
    if (!sourceResult || !isValidContent(sourceResult.textContent)) {
        return showSnackbar('è¯·å…ˆè·å–æºä»£ç ', 'warning');
    }
    const textarea = document.createElement('textarea');
    // åœ¨å¤åˆ¶çš„å†…å®¹å‰æ·»åŠ ä½œè€…ä¿¡æ¯å’ŒåŸå§‹URL
    textarea.value = ` <!-- \n ========================================\n - å°ä¹Œé¾ŸğŸ¢ç½‘é¡µå–æºå·¥å…·\n - ä½œè€…:331066\n - é‚®ç®±:li331066@163.com\n - è·å–æ—¶é—´: ${new Date().toLocaleString()}\n - åŸå§‹URL: ${state.baseUrl || 'æœªçŸ¥'}\n ========================================\n -->\n\n\n` + sourceResult.textContent;
    textarea.style.position = 'fixed';
    document.body.appendChild(textarea);
    try {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(textarea.value)
                .then(() => showSnackbar('ğŸŸ© å¤åˆ¶æˆåŠŸ', 'success'))
                .catch(() => fallbackCopy(textarea));
        } else {
            fallbackCopy(textarea);
        }
    } catch (error) {
        showSnackbar('âŒ å¤åˆ¶å¤±è´¥', 'error');
    } finally {
        document.body.removeChild(textarea);
    }

    // åˆ¤æ–­å†…å®¹æœ‰æ•ˆ
    function isValidContent(text) {
        return text && !text.includes('è¯·è¾“å…¥URL') && !text.includes('æ­£åœ¨åŠ è½½');
    }

    // å…¼å®¹æ€§å¤åˆ¶æ–¹æ¡ˆ
    function fallbackCopy(el) {
        el.select();
        el.setSelectionRange(0, 99999);
        document.execCommand('copy') ?
            showSnackbar('ğŸŸ© å·²å¤åˆ¶', 'success') :
            showSnackbar('âŒ è¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
    }
}

// ==== ä¸€é”®å¡«å……httpæˆ–httpsåŠŸèƒ½ ====
function fillHttp() {
    const urlInput = document.getElementById('url');
    if (!urlInput) return;
    let val = urlInput.value.trim();
    // å¦‚æœæ²¡æœ‰åè®®ï¼Œè‡ªåŠ¨é€‰å¡«httpsï¼Œæ— æ³•åˆ¤æ–­åªå¡«http
    if (!/^https?:\/\//i.test(val)) {
        // åˆ¤æ–­æ˜¯å¦åŸŸå/æˆ–åªå¡«äº†ä¸»æœº
        if (/^[\w.-]+\.[a-z]{2,}(\/.*)?$/i.test(val)) {
            urlInput.value = 'https://' + val;
        } else if (val) {
            urlInput.value = 'https://' + val;
        } else {
            urlInput.value = 'https://';
        }
        showSnackbar('å·²è‡ªåŠ¨å¡«å…… https://', 'success');
    } else {
        showSnackbar('å·²åŒ…å«åè®®ï¼Œæ— éœ€å¡«å……', 'info');
    }
    urlInput.focus();
    urlInput.setSelectionRange(urlInput.value.length, urlInput.value.length);
}

// ==== å…ƒæ•°æ®è§£æå‡½æ•° ====
function extractMetadata(html) {
    try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const metadata = [];
        metadata.push(`ğŸ”´æ ‡é¢˜: ${doc.querySelector('title')?.textContent || 'æ— æ ‡é¢˜'}`);
        metadata.push(`ğŸŸ¢æè¿°: ${doc.querySelector('meta[name="description"]')?.getAttribute('content') || 'æ— æè¿°'}`);
        metadata.push(`ğŸ”µå­—ç¬¦é›†: ${doc.querySelector('meta[charset]')?.getAttribute('charset') || 'æœªæŒ‡å®š'}`);
        document.getElementById('metadata-result').textContent = metadata.join('\n');
    } catch (error) {
        document.getElementById('metadata-result').textContent = `å…ƒæ•°æ®è§£æå¤±è´¥: ${error.message}`;
    }
}

// ==== é€‰é¡¹å¡åˆ‡æ¢å‡½æ•° ====
function switchTab(tabId) {
    ['source-tab', 'headers-tab', 'preview-tab', 'metadata-tab'].forEach(id => {
        document.getElementById(id).style.display = (id === tabId) ? 'flex' : 'none';
    });
    Array.from(document.querySelectorAll('.mdui-tab a')).forEach(a => {
        if (a.getAttribute('href') === `#${tabId}`) {
            a.classList.add('mdui-tab-active');
        } else {
            a.classList.remove('mdui-tab-active');
        }
    });
}

// ==== ä¸»å‡½æ•°ï¼šæŠ“å–æ‰€æœ‰é¡µé¢èµ„æºï¼ˆä¿æŠ¤åå•æ£€æµ‹ï¼‰ ====
async function fetchAllFiles() {
    if (state.isFetching) return showSnackbar('æ­£åœ¨è·å–ä¸­...', 'warning');
    const now = Date.now();
    if (now - state.lastFetchTime < state.MIN_FETCH_INTERVAL) {
        const remain = Math.ceil((state.MIN_FETCH_INTERVAL - (now - state.lastFetchTime)) / 1000);
        return showSnackbar(`è¯·${remain}ç§’åå†è¯•`, 'warning');
    }
    const urlInput = document.getElementById('url')?.value.trim();
    if (!urlInput) return showSnackbar('è¯·è¾“å…¥URL', 'warning');
    if (!/^https?:\/\//i.test(urlInput)) return showSnackbar('URLæ ¼å¼é”™è¯¯', 'warning');
    if (isProtected(urlInput)) {
        showSnackbar('è¯¥ç½‘å€å·²è¢«ä¿æŠ¤ï¼Œæ— æ³•çˆ¬å–', 'error');
        updateStatus('å—ä¿æŠ¤ç½‘å€ï¼Œç¦æ­¢è®¿é—®');
        document.getElementById('source-result').textContent = 'è¯¥ç½‘å€å·²è¢«ä¿æŠ¤ï¼Œæ— æ³•è·å–æºä»£ç ã€‚';
        return;
    }
    state.isFetching = true;
    state.lastFetchTime = now;
    state.baseUrl = urlInput;
    showLoading('æ­£åœ¨åˆ†æä¸»é¡µé¢...');
    updateStatus('æ­£åœ¨è¯·æ±‚æ•°æ®...');
    try {
        const startTime = Date.now();
        // 1. è·å–ä¸»é¡µé¢HTML
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(urlInput)}`;
        let response = await fetch(proxyUrl);
        let data = await response.json();
        if (!data.contents) throw new Error(data.error || 'æœªçŸ¥é”™è¯¯');
        const html = data.contents;
        extractMetadata(html);
        // 2. è§£æèµ„æºé“¾æ¥ï¼ˆæ”¯æŒæ‰€æœ‰æ ‡ç­¾åŠaæ ‡ç­¾ä¸‹è½½èµ„æºï¼‰
        const resources = findPageResources(html, urlInput);
        // 3. åŠ å…¥ä¸»é¡µé¢html
        resources.unshift({ name: 'index.html', url: urlInput, type: 'html' });
        state.files = resources;
        // 4. æ–‡ä»¶æ ‘æ¸²æŸ“
        renderFileTree();
        // 5. é»˜è®¤æ˜¾ç¤ºindex.html
        await showFileContent('index.html', urlInput, 'html');
        // 6. è·å–å“åº”å¤´
        try {
            let headResponse = await fetch(urlInput, { method: 'HEAD' });
            const headers = [];
            headResponse.headers.forEach((v, k) => headers.push(`${k}: ${v}`));
            document.getElementById('headers-result').textContent = headers.join('\n');
        } catch (e) {
            document.getElementById('headers-result').textContent = `å“åº”å¤´è·å–å¤±è´¥: ${e.message}`;
        }
        switchTab('source-tab');
        const elapsedTime = Date.now() - startTime;
        updateStatus('è·å–æˆåŠŸ', elapsedTime);
        showSnackbar(`è·å–æˆåŠŸ (${elapsedTime}ms)`, 'success');
        
        // ==== æ–°å¢ä»£ç ï¼šå°†æˆåŠŸè·å–çš„URLæ·»åŠ åˆ°å†å²è®°å½• ====
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥URL
        if (!state.history.includes(urlInput)) {
            state.history.unshift(urlInput); // æ·»åŠ åˆ°å†å²è®°å½•çš„å¼€å¤´
            // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼Œä¾‹å¦‚æœ€å¤šä¿å­˜50æ¡
            if (state.history.length > 50) {
                state.history = state.history.slice(0, 50);
            }
            saveHistoryToLocalStorage(); // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            updateHistoryList(); // æ›´æ–°å†å²è®°å½•åˆ—è¡¨UI
        }
    } catch (err) {
        document.getElementById('source-result').textContent = `è·å–å¤±è´¥: ${err.message}`;
        updateStatus('è·å–å¤±è´¥');
        showSnackbar(`å¤±è´¥: ${err.message}`, 'error');
    } finally {
        state.isFetching = false;
    }
}

// ==== æ–°å¢å‡½æ•°ï¼šä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½• ====
function loadHistoryFromLocalStorage() {
    const savedHistory = localStorage.getItem('webSourceToolHistory');
    if (savedHistory) {
        state.history = JSON.parse(savedHistory);
        // å¦‚æœæœ‰å†å²è®°å½•ï¼Œæ›´æ–°å†å²åˆ—è¡¨UI
        if (state.history.length > 0) {
            updateHistoryList();
        }
    }
}

// ==== æ–°å¢å‡½æ•°ï¼šä¿å­˜å†å²è®°å½•åˆ°æœ¬åœ°å­˜å‚¨ ====
function saveHistoryToLocalStorage() {
    localStorage.setItem('webSourceToolHistory', JSON.stringify(state.history));
}

// ==== æ–°å¢å‡½æ•°ï¼šæ›´æ–°å†å²è®°å½•åˆ—è¡¨UI ====
function updateHistoryList() {
    const historyListElement = document.getElementById('history-list');
    if (!historyListElement) return;
    
    // æ¸…ç©ºå½“å‰åˆ—è¡¨
    historyListElement.innerHTML = '';
    
    // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
    if (state.history.length === 0) {
        historyListElement.innerHTML = '<div class="mdui-list-item mdui-ripple" style="text-align: center; color: #999;">æš‚æ— å†å²è®°å½•</div>';
        return;
    }
    
    // éå†å†å²è®°å½•å¹¶åˆ›å»ºåˆ—è¡¨é¡¹
    state.history.forEach((url, index) => {
        const item = document.createElement('div');
        item.className = 'mdui-list-item mdui-ripple';
        item.textContent = url;
        item.onclick = () => {
            // ç‚¹å‡»å†å²è®°å½•é¡¹æ—¶ï¼Œå¡«å……URLå¹¶è·å–æ‰€æœ‰æ–‡ä»¶
            document.getElementById('url').value = url;
            fetchAllFiles();
            // å…³é—­å¯¹è¯æ¡†
            const dialog = document.querySelector('#history-dialog');
            if (dialog) {
                new mdui.Dialog(dialog).close();
            }
        };
        historyListElement.appendChild(item);
    });
}

// ==== æ–°å¢å‡½æ•°ï¼šæ˜¾ç¤ºå†å²è®°å½•å¯¹è¯æ¡† ====
function showHistory() {
    const dialog = document.querySelector('#history-dialog');
    if (dialog) {
        new mdui.Dialog(dialog).open();
        // ç¡®ä¿åˆ—è¡¨æ˜¯æœ€æ–°çš„
        updateHistoryList();
    }
}

// ==== æ–°å¢å‡½æ•°ï¼šæ¸…ç©ºå†å²è®°å½• ====
function clearHistory() {
    state.history = [];
    saveHistoryToLocalStorage();
    updateHistoryList();
    showSnackbar('å†å²è®°å½•å·²æ¸…ç©º', 'info');
}

// ==== èµ„æºè§£æï¼šæ”¯æŒæ‰€æœ‰ä¸»æµèµ„æºç±»å‹ ====
// è‡ªåŠ¨æŸ¥æ‰¾é¡µé¢å†…æ‰€æœ‰å¼•ç”¨ï¼ˆHTMLæ ‡ç­¾/æ ·å¼/è„šæœ¬/å›¾ç‰‡/åª’ä½“/å­—ä½“/ä¸‹è½½é“¾æ¥ç­‰ï¼‰
function findPageResources(html, baseUrl) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const resourceSet = new Set();
    const resources = [];
    function absUrl(url) {
        try {
            return new URL(url, baseUrl).href;
        } catch {
            return url;
        }
    }
    function pushRes(url) {
        if (!url) return;
        if (isProtected(url)) return;
        url = absUrl(url);
        if (resourceSet.has(url)) return;
        resourceSet.add(url);
        const type = getFileType(url);
        resources.push({ name: getFileName(url), url, type });
    }
    // linkæ ‡ç­¾ï¼ˆcssã€å­—ä½“ã€faviconç­‰ï¼‰
    doc.querySelectorAll('link').forEach(node => {
        pushRes(node.getAttribute('href'));
    });
    // scriptæ ‡ç­¾
    doc.querySelectorAll('script[src]').forEach(node => {
        pushRes(node.getAttribute('src'));
    });
    // img/image/source/video/audioæ ‡ç­¾
    ['img', 'image', 'video', 'audio', 'source', 'embed', 'object'].forEach(tag => {
        doc.querySelectorAll(tag).forEach(node => {
            pushRes(node.getAttribute('src'));
            pushRes(node.getAttribute('data'));
            pushRes(node.getAttribute('srcset')?.split(' ')[0]);
        });
    });
    // aæ ‡ç­¾ï¼ˆä¸‹è½½èµ„æºï¼šå¦‚ a href="file.mp3" downloadï¼‰
    doc.querySelectorAll('a[download]').forEach(node => {
        pushRes(node.getAttribute('href'));
    });
    // CSSæ–‡ä»¶é‡Œå¯èƒ½è¿˜æœ‰å›¾ç‰‡/å­—ä½“/åª’ä½“ç­‰ï¼ˆå¯é€‰ï¼šéœ€è¦è¿›ä¸€æ­¥çˆ¬å–CSSå†…å®¹å¹¶åˆ†æï¼‰
    // å…¶å®ƒè‡ªå®šä¹‰æ ‡ç­¾å¯è‡ªè¡Œæ‰©å±•
    return resources;
}

// ==== è·å–æ–‡ä»¶å ====
function getFileName(url) {
    try {
        let u = new URL(url);
        let name = u.pathname.split('/').pop() || u.hostname;
        if (!name) name = url;
        return decodeURIComponent(name);
    } catch {
        return url;
    }
}

// ==== åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼ˆæ ¹æ®æ‰©å±•åï¼‰ ====
function getFileType(url) {
    let ext = '';
    try {
        let name = new URL(url).pathname.split('/').pop();
        if (name && name.includes('.')) ext = name.split('.').pop().toLowerCase();
    } catch {
        ext = url.split('.').pop().toLowerCase();
    }
    return EXTENSION_TYPE_MAP[ext] || 'other';
}

// ==== æ–‡ä»¶æ ‘æ¸²æŸ“ ====
function renderFileTree() {
    const tree = document.getElementById('file-tree');
    if (!state.files || state.files.length === 0) {
        tree.innerHTML = 'æš‚æ— æ–‡ä»¶';
        return;
    }
    tree.innerHTML = '';
    state.files.forEach((file, idx) => {
        let li = document.createElement('li');
        li.textContent = file.name;
        li.title = file.url;
        li.dataset.idx = idx;
        if (file.name === state.selectedFile) li.classList.add('active');
        let urlSpan = document.createElement('span');
        urlSpan.className = 'file-url';
        urlSpan.textContent = file.url;
        li.appendChild(urlSpan);
        li.onclick = () => {
            showFileContent(file.name, file.url, file.type);
        };
        tree.appendChild(li);
    });
}

// ==== æ–‡ä»¶å†…å®¹æ˜¾ç¤ºï¼Œä¿æŠ¤åå•ç¦æ­¢è®¿é—® ====
async function showFileContent(name, url, type) {
    if (isProtected(url)) {
        document.getElementById('source-result').textContent = 'è¯¥æ–‡ä»¶å·²è¢«ä¿æŠ¤ï¼Œæ— æ³•è·å–ã€‚';
        return;
    }
    state.selectedFile = name;
    renderFileTree();
    showLoading(`æ­£åœ¨åŠ è½½: ${name}`);
    try {
        let content = state.fileContent[url];
        // å›¾ç‰‡ã€åª’ä½“ç›´æ¥é¢„è§ˆ
        if (type === 'img') {
            document.getElementById('source-result').innerHTML =
                `<br><a href="${url}" target="_blank">${url}</a>`;
            switchTab('source-tab');
            return;
        }
        if (type === 'media') {
            // éŸ³é¢‘è§†é¢‘ç›´æ¥é¢„è§ˆ
            let ext = url.split('.').pop().toLowerCase();
            if (['mp3','wav','ogg','aac','flac','m4a','mp2','opus'].includes(ext)) {
                document.getElementById('source-result').innerHTML =
                    `<audio controls src="${url}"></audio><br><a href="${url}" target="_blank">${url}</a>`;
                switchTab('source-tab');
                return;
            }
            if (['mp4','webm','mov','avi','mkv','flv','3gp','mpeg'].includes(ext)) {
                document.getElementById('source-result').innerHTML =
                    `<video controls src="${url}" style="max-width:100%;max-height:440px"></video><br><a href="${url}" target="_blank">${url}</a>`;
                switchTab('source-tab');
                return;
            }
        }
        // å­—ä½“/å…¶å®ƒäºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥ç»™ä¸‹è½½é“¾æ¥
        if (type === 'font' || type === 'other') {
            document.getElementById('source-result').innerHTML =
                `<a href="${url}" target="_blank" download="${name}">ä¸‹è½½æ–‡ä»¶ï¼š${name}</a>`;
            switchTab('source-tab');
            return;
        }
        // æ–‡æœ¬å†…å®¹
        if (!content) {
            let proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
            let response = await fetch(proxyUrl);
            let data = await response.json();
            content = data.contents || '';
            state.fileContent[url] = content;
        }
        // åˆ›å»ºpreå’Œcodeå…ƒç´ 
const pre = document.createElement('pre');
const code = document.createElement('code');
code.className = 'language-html'; // é»˜è®¤ä½¿ç”¨htmlé«˜äº®
code.textContent = content;
pre.appendChild(code);
document.getElementById('source-result').innerHTML = '';
document.getElementById('source-result').appendChild(pre);

// æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®ä¸åŒçš„é«˜äº®è¯­è¨€
let lang = 'html';
if (type === 'css') lang = 'css';
if (type === 'js') lang = 'javascript';
code.className = `language-${lang}`;

// æ‰‹åŠ¨è§¦å‘Prismé«˜äº®
if (window.Prism) {
    Prism.highlightElement(code);
}
        switchTab('source-tab');
    } catch (e) {
        document.getElementById('source-result').textContent = `è·å–å¤±è´¥: ${e.message}`;
    }
}

// ==== å“åº”å¤´/é¢„è§ˆ/å…ƒæ•°æ®tabæ”¯æŒåˆ‡æ¢ ====
document.querySelectorAll('.mdui-tab a').forEach(a => {
    a.addEventListener('click', function(e){
        e.preventDefault();
        let id = a.getAttribute('href').replace('#', '');
        switchTab(id);
        if (id === 'preview-tab') {
            document.getElementById('preview-frame').src = state.baseUrl || '';
        }
    });
});

    </script>
    <script>
   // ======================
// ä»£ç é¢„è§ˆåŠŸèƒ½
// ======================

// çŠ¶æ€å˜é‡
let codePreviewDialog = null;
let isDialogInitialized = false;

/**
 * åˆå§‹åŒ–ä»£ç é¢„è§ˆå¼¹çª—
 */
function initCodePreviewDialog() {
    if (isDialogInitialized) return;
    
    // åˆ›å»ºå¼¹çª—å®ä¾‹
    codePreviewDialog = new mdui.Dialog('#code-preview-dialog', {
        history: false,
        modal: true,
        closeOnEsc: true,
        destroyOnClose: false
    });
    
    // ç»‘å®šå¤åˆ¶æŒ‰é’®äº‹ä»¶ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜ç¡®ä¿å§‹ç»ˆæœ‰æ•ˆï¼‰
    document.addEventListener('click', function(e) {
        if (e.target && (e.target.id === 'copy-preview-code-btn' || 
                         e.target.closest('#copy-preview-code-btn'))) {
            copyCodePreview();
        }
    });
    
    isDialogInitialized = true;
    console.log("ä»£ç é¢„è§ˆå¼¹çª—åˆå§‹åŒ–å®Œæˆ");
}

/**
 * æ˜¾ç¤ºä»£ç é¢„è§ˆå¼¹çª—
 */
function showCodePreviewDialog(event) {
    // é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }
    
    // ç¡®ä¿å¼¹çª—å·²åˆå§‹åŒ–
    if (!isDialogInitialized) {
        initCodePreviewDialog();
    }
    
    const codePreviewTitle = document.getElementById('code-preview-title');
    const codePreviewContent = document.getElementById('code-preview-content');
    
    // è·å–å½“å‰é€‰ä¸­çš„æ–‡ä»¶ä¿¡æ¯
    const currentFile = state.files.find(f => f.name === state.selectedFile);
    if (!currentFile) {
        showSnackbar('æ²¡æœ‰é€‰ä¸­æ–‡ä»¶', 'warning');
        return;
    }
    
    try {
        // è®¾ç½®é¢„è§ˆæ ‡é¢˜
        codePreviewTitle.textContent = `${currentFile.name} é¢„è§ˆ`;
        
        // æ¸…ç©ºé¢„è§ˆå†…å®¹
        codePreviewContent.innerHTML = '';
        
        // æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
        switch(currentFile.type) {
            case 'img':
                // å›¾ç‰‡é¢„è§ˆ
                const img = document.createElement('img');
                img.src = currentFile.url;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '70vh';
                img.style.display = 'block';
                img.style.margin = '0 auto';
                codePreviewContent.appendChild(img);
                break;
                
            case 'media':
                // åª’ä½“æ–‡ä»¶é¢„è§ˆ
                const ext = currentFile.name.split('.').pop().toLowerCase();
                if (['mp3','wav','ogg','aac','flac','m4a','mp2','opus'].includes(ext)) {
                    // éŸ³é¢‘æ–‡ä»¶
                    const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = currentFile.url;
                    audio.style.width = '100%';
                    codePreviewContent.appendChild(audio);
                } else if (['mp4','webm','mov','avi','mkv','flv','3gp','mpeg'].includes(ext)) {
                    // è§†é¢‘æ–‡ä»¶
                    const video = document.createElement('video');
                    video.controls = true;
                    video.src = currentFile.url;
                    video.style.maxWidth = '100%';
                    video.style.maxHeight = '70vh';
                    video.style.display = 'block';
                    video.style.margin = '0 auto';
                    codePreviewContent.appendChild(video);
                } else {
                    // å…¶ä»–åª’ä½“æ–‡ä»¶æ˜¾ç¤ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.href = currentFile.url;
                    link.textContent = 'ä¸‹è½½åª’ä½“æ–‡ä»¶: ' + currentFile.name;
                    link.target = '_blank';
                    codePreviewContent.appendChild(link);
                }
                break;
                
            case 'font':
            case 'other':
                // å­—ä½“æˆ–å…¶ä»–æ–‡ä»¶æ˜¾ç¤ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                link.href = currentFile.url;
                link.textContent = 'ä¸‹è½½æ–‡ä»¶: ' + currentFile.name;
                link.target = '_blank';
                codePreviewContent.appendChild(link);
                break;
                
            default:
                // æ–‡æœ¬æ–‡ä»¶æ˜¾ç¤ºä»£ç 
                const sourceResult = document.getElementById('source-result');
                if (!sourceResult || !sourceResult.textContent || 
                    sourceResult.textContent.includes('è¯·è¾“å…¥URL') || 
                    sourceResult.textContent.includes('æ­£åœ¨åŠ è½½') ||
                    sourceResult.textContent.includes('è·å–å¤±è´¥') ||
                    sourceResult.textContent.includes('æš‚æ— æ–‡ä»¶') ||
                    sourceResult.textContent.trim() === '') {
                    showSnackbar('æš‚æ— å¯ç”¨æºä»£ç é¢„è§ˆ', 'warning');
                    return;
                }
                
                // ä¿ç•™ä»£ç é«˜äº®æ ¼å¼
                if (sourceResult.querySelector('pre code')) {
                    // å…‹éš†èŠ‚ç‚¹ä»¥é¿å…åŸå§‹å†…å®¹è¢«å½±å“
                    const clonedContent = sourceResult.querySelector('pre').cloneNode(true);
                    codePreviewContent.appendChild(clonedContent);
                    
                    // é‡æ–°è§¦å‘ä»£ç é«˜äº®
                    if (window.Prism) {
                        Prism.highlightAllUnder(codePreviewContent);
                    }
                } else {
                    codePreviewContent.textContent = sourceResult.textContent;
                }
        }
        
        // è°ƒæ•´å¼¹çª—å¤§å°å’Œæ ·å¼
        const dialog = document.getElementById('code-preview-dialog');
        if (currentFile.type === 'img' || currentFile.type === 'media') {
            dialog.style.maxWidth = '90%';
            dialog.style.maxHeight = '90vh';
        } else {
            dialog.style.width = '95%';
            dialog.style.maxWidth = '1200px';
            dialog.style.maxHeight = '85vh';
        }
        
        // æ‰“å¼€å¼¹çª—
        codePreviewDialog.open();
    } catch (error) {
        console.error("æ˜¾ç¤ºé¢„è§ˆæ—¶å‡ºé”™:", error);
        showSnackbar('æ‰“å¼€é¢„è§ˆå¤±è´¥: ' + error.message, 'error');
    }
}

/**
 * å¤åˆ¶é¢„è§ˆä»£ç åˆ°å‰ªè´´æ¿
 */
function copyCodePreview() {
    try {
        const codePreviewContent = document.getElementById('code-preview-content');
        if (!codePreviewContent) {
            showSnackbar('å¤åˆ¶å¤±è´¥: æ‰¾ä¸åˆ°å†…å®¹', 'error');
            return;
        }
        
        // è·å–å½“å‰é€‰ä¸­çš„æ–‡ä»¶ä¿¡æ¯
        const currentFile = state.files.find(f => f.name === state.selectedFile);
        if (!currentFile) {
            showSnackbar('æ²¡æœ‰é€‰ä¸­æ–‡ä»¶', 'warning');
            return;
        }
        
        // è·å–å½“å‰æ—¶é—´
        const now = new Date();
        const formattedTime = now.toLocaleString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        }).replace(/\//g, '-');
        
        // æ„å»ºä½œè€…ä¿¡æ¯å¤´éƒ¨
        const authorInfo = [
            ' <!-- ',
            ' ========================================',
            ` - å°ä¹Œé¾ŸğŸ¢ç½‘é¡µå–æºå·¥å…·`,
            ` - ä½œè€…: ${state.author || '331066'}`,
            ` - é‚®ç®±: li331066@163.com`,
            ` - è·å–æ—¶é—´: ${formattedTime}`,
            ` - åŸå§‹URL: ${currentFile.url}`,
            ' ========================================',
            ' -->',
            '  ',
            '  ',
            '  ',
            ''
        ].join('\n');
        
        // å¯¹äºéæ–‡æœ¬æ–‡ä»¶ï¼Œå¤åˆ¶URLå’Œä½œè€…ä¿¡æ¯
        if (currentFile.type !== 'html' && currentFile.type !== 'css' && currentFile.type !== 'js') {
            const textToCopy = `${authorInfo}æ–‡ä»¶URL: ${currentFile.url}`;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showSnackbar('æ–‡ä»¶ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(err => {
                    fallbackCopyText(textToCopy);
                });
            } else {
                fallbackCopyText(textToCopy);
            }
            return;
        }
        
        // å¯¹äºæ–‡æœ¬æ–‡ä»¶ï¼Œå¤åˆ¶ä»£ç å†…å®¹å’Œä½œè€…ä¿¡æ¯
        let codeText = '';
        if (codePreviewContent.querySelector('code')) {
            codeText = codePreviewContent.querySelector('code').textContent;
        } else {
            codeText = codePreviewContent.textContent;
        }
        
        if (!codeText || codeText.trim() === '') {
            showSnackbar('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'warning');
            return;
        }
        
        // ç»„åˆä½œè€…ä¿¡æ¯å’Œä»£ç å†…å®¹
        const fullTextToCopy = `${authorInfo}${codeText}`;
        
        // ä½¿ç”¨ç°ä»£APIå°è¯•å¤åˆ¶
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(fullTextToCopy).then(() => {
                showSnackbar('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopyText(fullTextToCopy);
            });
        } else {
            // ä½¿ç”¨é™çº§æ–¹æ¡ˆ
            fallbackCopyText(fullTextToCopy);
        }
    } catch (error) {
        console.error("å¤åˆ¶ä»£ç æ—¶å‡ºé”™:", error);
        showSnackbar('å¤åˆ¶å¤±è´¥: ' + error.message, 'error');
    }
}

/**
 * é™çº§å¤åˆ¶æ–¹æ¡ˆ
 */
function fallbackCopyText(text) {
    try {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        
        // é¿å…æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
        textArea.style.position = 'fixed';
        textArea.style.top = '0';
        textArea.style.left = '0';
        textArea.style.width = '2em';
        textArea.style.height = '2em';
        textArea.style.padding = '0';
        textArea.style.border = 'none';
        textArea.style.outline = 'none';
        textArea.style.boxShadow = 'none';
        textArea.style.background = 'transparent';
        
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        const successful = document.execCommand('copy');
        document.body.removeChild(textArea);
        
        if (successful) {
            showSnackbar('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        } else {
            showSnackbar('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
        }
    } catch (err) {
        showSnackbar('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
    }
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹åŒ–å¼¹çª—
    initCodePreviewDialog();
    
    // æ·»åŠ åŒå‡»äº‹ä»¶ç›‘å¬å™¨åˆ°ä»£ç é¢„è§ˆåŒº
    const codeViewContainer = document.querySelector('.code-view-container');
    if (codeViewContainer) {
        // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§ç›‘å¬å™¨
        codeViewContainer.removeEventListener('dblclick', showCodePreviewDialog);
        // æ·»åŠ æ–°ç›‘å¬å™¨
        codeViewContainer.addEventListener('dblclick', showCodePreviewDialog);
        console.log("åŒå‡»ç›‘å¬å™¨å·²ç»‘å®šåˆ°ä»£ç é¢„è§ˆåŒº");
    }
    
    // ç¡®ä¿å¼¹çª—å…³é—­æŒ‰é’®æ­£å¸¸å·¥ä½œ
    const closeButtons = document.querySelectorAll('#code-preview-dialog .mdui-dialog-close, #code-preview-dialog .mdui-dialog-actions .mdui-dialog-close');
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            if (codePreviewDialog) {
                codePreviewDialog.close();
            }
        });
    });
});

</script>
</body>
</html>
